{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["NegociacaoController","$","document","querySelector","bind","_ordemAtual","_inputData","_inputQuantidade","_inputValor","_negociacaoService","NegociacaoService","_listaNegociacoes","Bind","ListaNegociacoes","NegociacoesView","_mensagem","Mensagem","MensagemView","_init","lista","then","negociacoes","forEach","adiciona","negociacao","catch","texto","erro","setInterval","importaNegociacoes","JSON","stringify","event","preventDefault","_criaNegociacao","cadastrar","mensagem","_limpaFormulario","importa","reduce","arrayAchatado","array","concat","error","apaga","esvazia","msg","coluna","inverteOrdem","ordena","a","b","Negociacao","DateHelper","StringToDate","value","parseInt","parseFloat","focus"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["class NegociacaoController {\r\n  constructor() {\r\n    let $ = document.querySelector.bind(document);\r\n    this._ordemAtual = '';\r\n    this._inputData = $('#data');\r\n    this._inputQuantidade = $('#quantidade');\r\n    this._inputValor = $('#valor');\r\n\r\n    this._negociacaoService = new NegociacaoService();\r\n    this._listaNegociacoes = new Bind(\r\n      new ListaNegociacoes(),\r\n      new NegociacoesView($('#negociacoesView')),\r\n      'adiciona', 'esvazia', 'ordena', 'inverteOrdem'\r\n    );\r\n    this._mensagem = new Bind(\r\n      new Mensagem(),\r\n      new MensagemView($('#mensagemView')),\r\n      'texto'\r\n    );\r\n\r\n    this._init();\r\n  }\r\n\r\n  _init() {\r\n    this._negociacaoService\r\n        .lista()\r\n        .then(negociacoes =>\r\n          negociacoes.forEach(negociacao =>\r\n  \t  \t\t\tthis._listaNegociacoes.adiciona(negociacao)))\r\n        .catch(erro => this._mensagem.texto = erro);\r\n\r\n      setInterval(() => this.importaNegociacoes(), 3000);\r\n  }\r\n\r\n  isEquals(negociacao) {\r\n    return JSON.stringify(this) == JSON.stringify(negociacao)\r\n  }\r\n\r\n  adiciona(event) {\r\n    event.preventDefault();\r\n\r\n    let negociacao = this._criaNegociacao();\r\n    this._negociacaoService\r\n        .cadastrar(negociacao)\r\n        .then(mensagem => {\r\n          this._listaNegociacoes.adiciona(negociacao);\r\n          this._mensagem.texto = mensagem;\r\n          this._limpaFormulario();\r\n        })\r\n        .catch(erro => this._mensagem.texto = erro);\r\n  }\r\n\r\n  importaNegociacoes() {\r\n    this._negociacaoService\r\n        .importa(this._listaNegociacoes.negociacoes)\r\n        .then(negociacoes => {\r\n          negociacoes\r\n            .reduce((arrayAchatado, array) => arrayAchatado.concat(array), [])\r\n            .forEach(negociacao => this._listaNegociacoes.adiciona(negociacao));\r\n            this._mensagem.texto = 'Negociações importadas com sucesso';\r\n        })\r\n        .catch(error => this._mensagem.texto = error);\r\n  }\r\n\r\n  apaga() {\r\n    this._negociacaoService\r\n        .apaga()\r\n        .then(msg => {\r\n          this._listaNegociacoes.esvazia();\r\n       \t\tthis._mensagem.texto = msg;\r\n        })\r\n        .catch(erro => this._mensagem.texto = erro);\r\n  }\r\n\r\n  ordenar(coluna) {\r\n    if (this._ordemAtual == coluna) {\r\n        this._listaNegociacoes.inverteOrdem();\r\n    } else {\r\n        this._listaNegociacoes.ordena((a,b) => a[coluna] - b[coluna]);\r\n    }\r\n\r\n    this._ordemAtual = coluna;\r\n  }\r\n\r\n  _criaNegociacao() {\r\n    return new Negociacao(\r\n      DateHelper.StringToDate(this._inputData.value),\r\n      parseInt(this._inputQuantidade.value),\r\n      parseFloat(this._inputValor.value)\r\n    );\r\n  }\r\n\r\n  _limpaFormulario() {\r\n    this._inputData.value = '';\r\n    this._inputQuantidade.value = 1;\r\n    this._inputValor.value = 0.0;\r\n\r\n    this._inputData.focus();\r\n  }\r\n}\r\n"]}